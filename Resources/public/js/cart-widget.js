define(["require","exports","jquery","underscore","bootstrap","ekyna-ui","ekyna-dispatcher"],function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(){}return a}(),i=function(){function a(){this.enabled=!1}return a.prototype.initialize=function(a){var b=this;if(this.config=d.defaults(a||{},{widgetSelector:"#cart-widget",toggleSelector:"> a",contentSelector:"> div"}),this.$widget=c(this.config.widgetSelector),1!=this.$widget.length)throw"Widget not found ! ("+this.config.widgetSelector+")";if(this.$content=this.$widget.find(this.config.contentSelector),1!=this.$content.length)throw"Widget content not found ! ("+this.config.contentSelector+")";if(this.$toggle=this.$widget.find(this.config.toggleSelector),1!=this.$toggle.length)throw"Widget toggle button not found ! ("+this.config.toggleSelector+")";return this.contentShowHandler=d.bind(this.onContentShow,this),g.on("ekyna_commerce.sale_view_response",function(){b.$content.empty()}),this},a.prototype.enable=function(){if(!this.enabled)return this.enabled=!0,this.$widget.on("show.bs.dropdown",this.contentShowHandler),this},a.prototype.disable=function(){if(this.enabled)return this.enabled=!1,this.$widget.off("show.bs.dropdown",this.contentShowHandler),this},a.prototype.onContentShow=function(){this.$content.is(":empty")&&this.loadContent()},a.prototype.loadContent=function(){var a=this;this.$content.loadingSpinner("on"),this.contentXHR&&this.contentXHR.abort(),this.contentXHR=c.ajax({url:this.$widget.data("url"),dataType:"xml",cache:!1}),this.contentXHR.done(function(b){return a.parseResponse(b)}),this.contentXHR.fail(function(){console.log("Failed to load account widget content.")})},a.prototype.parseResponse=function(a){var b=a.querySelector("cart-widget");if(b){this.$content.loadingSpinner("off").html(b.textContent);var c=new h;return g.trigger("ekyna_commerce.cart_status",c),!0}return!1},a}();return new i});