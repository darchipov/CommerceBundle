define(["jquery","routing","select2"],function(a,b){"use strict";return a.fn.subjectChoiceWidget=function(b){return b=a.extend({limit:8},b),this.each(function(){console.log("subjectChoiceWidget");var b=a(this),c=!1,d=b.find(".provider"),e=b.find(".identifier"),f=b.find(".subject");if(!d.is(":disabled")){var g=function(){console.log("providerChangeHandler"),f.prop("disabled",!0).off("change"),e.val(null),c&&(f.select2("destroy"),c=!1);var b,g,h=d.val();if(h&&(b=d.find('option[value="'+d.val()+'"]'),1==b.size()&&(g=b.data("config"),g&&g.hasOwnProperty("search")))){var i=function(b){return b.id?a("<span>"+b.choice_label+"</span>"):"Rechercher"},j=d.closest(".modal");j.size()||(j=null),f.prop("disabled",!1).select2({placeholder:"Rechercher ...",allowClear:!0,selectOnClose:!0,minimumInputLength:3,templateResult:i,templateSelection:i,dropdownParent:j,ajax:{delay:300,url:g.search,dataType:"json",data:function(a){return{query:a.term,page:a.page,limit:10}},processResults:function(a,b){return b.page=b.page||1,{results:a.results,pagination:{more:b.page*g.limit<a.total_count}}},escapeMarkup:function(a){return a}}}).on("change",function(){e.val(a(this).val())}),c=!0}};d.on("change",g),g()}}),this},{init:function(a){a.subjectChoiceWidget()}}});