<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="ekyna_commerce.attribute_slot.class">Ekyna\Component\Commerce\Product\Entity\AttributeSlot</parameter>

        <parameter key="ekyna_commerce.bundle_choice.class">Ekyna\Component\Commerce\Product\Entity\BundleChoice</parameter>
        <parameter key="ekyna_commerce.bundle_choice_rule.class">Ekyna\Component\Commerce\Product\Entity\BundleChoiceRule</parameter>
        <parameter key="ekyna_commerce.bundle_slot.class">Ekyna\Component\Commerce\Product\Entity\BundleSlot</parameter>

        <parameter key="ekyna_commerce.option_group.class">Ekyna\Component\Commerce\Product\Entity\OptionGroup</parameter>
        <parameter key="ekyna_commerce.option.class">Ekyna\Component\Commerce\Product\Entity\Option</parameter>

        <parameter key="ekyna_commerce.order_address.class">Ekyna\Bundle\CommerceBundle\Entity\OrderAddress</parameter>
        <parameter key="ekyna_commerce.order_adjustment.class">Ekyna\Component\Commerce\Order\Entity\OrderAdjustment</parameter>
        <parameter key="ekyna_commerce.order_item.class">Ekyna\Component\Commerce\Order\Entity\OrderItem</parameter>
        <parameter key="ekyna_commerce.order_item_adjustment.class">Ekyna\Component\Commerce\Order\Entity\OrderItemAdjustment</parameter>

        <parameter key="ekyna_commerce.payment.class">Ekyna\Component\Commerce\Payment\Entity\Payment</parameter>
        <parameter key="ekyna_commerce.payment_method.class">Ekyna\Component\Commerce\Payment\Entity\PaymentMethod</parameter>

        <parameter key="ekyna_commerce.shipment.class">Ekyna\Component\Commerce\Shipment\Entity\Shipment</parameter>
        <parameter key="ekyna_commerce.shipment_item.class">Ekyna\Component\Commerce\Shipment\Entity\ShipmentItem</parameter>
        <parameter key="ekyna_commerce.shipment_method.class">Ekyna\Component\Commerce\Shipment\Entity\ShipmentMethod</parameter>
    </parameters>

    <services>

        <!-- Calculator -->
        <service id="ekyna_commerce.common.calculator"
                 class="Ekyna\Component\Commerce\Common\Calculator\Calculator"/>

        <!-- Generator -->
        <service id="ekyna_commerce.order.number_generator"
                 class="Ekyna\Bundle\CommerceBundle\Service\Order\NumberGenerator">
            <argument type="service" id="doctrine.orm.default_entity_manager"/>
            <argument>%ekyna_commerce.order.class%</argument>
        </service>

        <!-- Helpers -->
        <service id="ekyna_commerce.helper.subject"
                 class="Ekyna\Bundle\CommerceBundle\Helper\SubjectHelper">
            <argument type="service" id="ekyna_commerce.subject.resolver_registry"/>
        </service>
        <service id="ekyna_commerce.helper.constant"
                 class="Ekyna\Bundle\CommerceBundle\Helper\ConstantHelper">
            <argument type="service" id="translator"/>
        </service>

        <!-- Resolvers -->
        <service id="ekyna_commerce.subject.resolver_registry"
                 class="Ekyna\Component\Commerce\Subject\Resolver\SubjectResolverRegistry"/>
        <service id="ekyna_commerce.order.state_resolver"
                 class="Ekyna\Bundle\CommerceBundle\Service\Order\StateResolver"/>

        <!-- Variant builder -->
        <service id="ekyna_commerce.product.variant_generator"
                 class="Ekyna\Component\Commerce\Product\Generator\VariantGenerator">
            <argument>%ekyna_commerce.product.class%</argument>
        </service>

        <!-- Resource event listeners -->
        <service id="ekyna_commerce.customer.event_subscriber"
                 class="Ekyna\Component\Commerce\Bridge\Symfony\EventListener\CustomerEventSubscriber">
            <tag name="resource.event_subscriber"/>
        </service>
        <service id="ekyna_commerce.product.event_subscriber"
                 class="Ekyna\Component\Commerce\Bridge\Symfony\EventListener\ProductEventSubscriber">
            <tag name="resource.event_subscriber"/>
        </service>
        <service id="ekyna_commerce.order.event_subscriber"
                 class="Ekyna\Bundle\CommerceBundle\EventListener\OrderEventSubscriber">
            <argument type="service" id="ekyna_commerce.order.number_generator"/>
            <argument type="service" id="ekyna_commerce.common.calculator"/>
            <argument type="service" id="ekyna_commerce.order.state_resolver"/>
            <tag name="resource.event_subscriber"/>
            <tag name="kernel.event_subscriber"/> <!-- TODO remove this tag -->
        </service>

        <!-- Form event listeners -->
        <service id="ekyna_commerce.product.form_type.event_subscriber"
                 class="Ekyna\Bundle\CommerceBundle\Form\EventListener\ProductTypeSubscriber">
            <argument>%ekyna_commerce.product.class%</argument>
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <argument>%ekyna_commerce.attribute_set.class%</argument>
        </service>

        <!-- Form types -->
        <service id="ekyna_commerce.attribute.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\AttributeType">
            <argument>%ekyna_commerce.attribute.class%</argument>
            <argument>%ekyna_commerce.attribute_group.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.attribute_slot.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\AttributeSlotType">
            <argument>%ekyna_commerce.attribute_slot.class%</argument>
            <argument>%ekyna_commerce.attribute_group.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.bundle_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\BundleChoiceType">
            <argument>%ekyna_commerce.bundle_choice.class%</argument>
            <argument>%ekyna_commerce.product.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.bundle_choice_rule.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\BundleChoiceRuleType">
            <argument>%ekyna_commerce.bundle_choice_rule.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.bundle_slot.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\BundleSlotType">
            <argument>%ekyna_commerce.bundle_slot.class%</argument>
            <argument>%ekyna_commerce.bundle_choice.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.country_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\CountryChoiceType">
            <argument>%ekyna_commerce.country.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.currency_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\CurrencyChoiceType">
            <argument>%ekyna_commerce.currency.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.customer_address.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\CustomerAddressType">
            <argument>%ekyna_commerce.customer_address.class%</argument>
            <argument>%ekyna_commerce.country.class%</argument>
            <argument>%ekyna_commerce.customer.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.customer.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\CustomerType">
            <argument>%ekyna_commerce.customer.class%</argument>
            <argument>%ekyna_commerce.customer_group.class%</argument>
            <argument>%ekyna_user.user.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.option_group.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\OptionGroupType">
            <argument>%ekyna_commerce.option_group.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.option.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\OptionType">
            <argument>%ekyna_commerce.option.class%</argument>
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order_address.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderAddressType">
            <argument>%ekyna_commerce.order_address.class%</argument>
            <argument>%ekyna_commerce.country.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order_adjustment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderAdjustmentType">
            <argument>%ekyna_commerce.order_adjustment.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order_item_adjustment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderItemAdjustmentType">
            <argument>%ekyna_commerce.order_item_adjustment.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order_item.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderItemType">
            <argument>%ekyna_commerce.order_item.class%</argument>
            <argument type="service" id="ekyna_commerce.helper.subject"/>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderType">
            <argument>%ekyna_commerce.order.class%</argument>
            <argument>%ekyna_commerce.customer.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.product.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\ProductType">
            <argument type="service" id="ekyna_commerce.product.form_type.event_subscriber"/>
            <argument>%ekyna_commerce.product.class%</argument>
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.tax_group.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\TaxGroupType">
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <argument>%ekyna_commerce.tax_rule.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.tax_rule.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\TaxRuleType">
            <argument>%ekyna_commerce.tax_rule.class%</argument>
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <argument>%ekyna_commerce.tax.class%</argument>
            <argument>%ekyna_commerce.customer_group.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.tax.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\TaxType">
            <argument>%ekyna_commerce.tax.class%</argument>
            <argument>%ekyna_commerce.country.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Table types -->
        <service id="ekyna_commerce.customer.table_type"
                 class="Ekyna\Bundle\CommerceBundle\Table\Type\CustomerType">
            <argument>%ekyna_commerce.customer.class%</argument>
            <argument>%ekyna_commerce.customer_group.class%</argument>
            <tag name="table.type" alias="ekyna_commerce_customer"/>
        </service>

        <!-- Table column types -->
        <service id="ekyna_commerce.order_customer.column_type"
                 class="Ekyna\Bundle\CommerceBundle\Table\Column\OrderCustomerType">
            <argument type="service" id="ekyna_user.helper.identity"/>
            <tag name="table.column_type" alias="ekyna_commerce_order_customer"/>
        </service>
        <service id="ekyna_commerce.order_state.column_type"
                 class="Ekyna\Bundle\CommerceBundle\Table\Column\OrderStateType">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <tag name="table.column_type" alias="ekyna_commerce_order_state"/>
        </service>
        <service id="ekyna_commerce.product_type.column_type"
                 class="Ekyna\Bundle\CommerceBundle\Table\Column\ProductTypeType">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <tag name="table.column_type" alias="ekyna_commerce_product_type"/>
        </service>
        <service id="ekyna_commerce.payment_state.column_type"
                 class="Ekyna\Bundle\CommerceBundle\Table\Column\PaymentStateType">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <tag name="table.column_type" alias="ekyna_commerce_payment_state"/>
        </service>
        <service id="ekyna_commerce.shipment_state.column_type"
                 class="Ekyna\Bundle\CommerceBundle\Table\Column\ShipmentStateType">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <tag name="table.column_type" alias="ekyna_commerce_shipment_state"/>
        </service>

        <!-- View -->
        <service id="ekyna_commerce.common.view_builder"
                class="Ekyna\Component\Commerce\Common\View\Builder">
            <argument type="service" id="ekyna_commerce.common.calculator"/>
        </service>

        <!-- Twig extensions -->
        <service id="ekyna_commerce.twig.address_extension"
                 class="Ekyna\Bundle\CommerceBundle\Twig\AddressExtension">
            <tag name="twig.extension"/>
        </service>
        <service id="ekyna_commerce.twig.order_extension"
                 class="Ekyna\Bundle\CommerceBundle\Twig\OrderExtension">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <argument type="service" id="ekyna_commerce.common.view_builder"/>
            <tag name="twig.extension"/>
        </service>
        <service id="ekyna_commerce.twig.payment_extension"
                 class="Ekyna\Bundle\CommerceBundle\Twig\PaymentExtension">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <tag name="twig.extension"/>
        </service>
        <service id="ekyna_commerce.twig.product_extension"
                 class="Ekyna\Bundle\CommerceBundle\Twig\ProductExtension">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <tag name="twig.extension"/>
        </service>
        <service id="ekyna_commerce.twig.shipment_extension"
                 class="Ekyna\Bundle\CommerceBundle\Twig\ShipmentExtension">
            <argument type="service" id="ekyna_commerce.helper.constant"/>
            <tag name="twig.extension"/>
        </service>

    </services>

</container>
