<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="ekyna_commerce.order_address.class">Ekyna\Bundle\CommerceBundle\Entity\OrderAddress</parameter>
        <parameter key="ekyna_commerce.order_adjustment.class">Ekyna\Component\Commerce\Order\Entity\OrderAdjustment</parameter>
        <parameter key="ekyna_commerce.order_item.class">Ekyna\Component\Commerce\Order\Entity\OrderItem</parameter>
        <parameter key="ekyna_commerce.order_item_adjustment.class">Ekyna\Component\Commerce\Order\Entity\OrderItemAdjustment</parameter>

        <parameter key="ekyna_commerce.payment.class">Ekyna\Component\Commerce\Payment\Entity\Payment</parameter>
        <parameter key="ekyna_commerce.payment_method.class">Ekyna\Component\Commerce\Payment\Entity\PaymentMethod</parameter>

        <parameter key="ekyna_commerce.shipment.class">Ekyna\Component\Commerce\Shipment\Entity\Shipment</parameter>
        <parameter key="ekyna_commerce.shipment_item.class">Ekyna\Component\Commerce\Shipment\Entity\ShipmentItem</parameter>
        <parameter key="ekyna_commerce.shipment_method.class">Ekyna\Component\Commerce\Shipment\Entity\ShipmentMethod</parameter>
    </parameters>

    <services>
        <!-- Calculator -->
        <service id="ekyna_commerce.order.calculator" class="Ekyna\Component\Commerce\Order\Calculator\Calculator"/>

        <!-- Generator -->
        <service id="ekyna_commerce.order.number_generator" class="Ekyna\Bundle\CommerceBundle\Service\Order\NumberGenerator">
            <argument type="service" id="doctrine.orm.default_entity_manager"/>
            <argument>%ekyna_commerce.order.class%</argument>
        </service>

        <!-- Helpers -->
        <service id="ekyna_commerce.subject.helper" class="Ekyna\Bundle\CommerceBundle\Helper\SubjectHelper">
            <argument type="service" id="ekyna_commerce.subject.resolver_registry" />
        </service>
        <service id="ekyna_commerce.state_helper" class="Ekyna\Bundle\CommerceBundle\Service\StateHelper">
            <argument type="service" id="translator"/>
        </service>

        <!-- Resolvers -->
        <service id="ekyna_commerce.subject.resolver_registry" class="Ekyna\Component\Commerce\Subject\Resolver\SubjectResolverRegistry"/>
        <service id="ekyna_commerce.order.state_resolver" class="Ekyna\Bundle\CommerceBundle\Service\Order\StateResolver"/>

        <!-- Event listeners -->
        <service id="ekyna_commerce.order.event_subscriber" class="Ekyna\Bundle\CommerceBundle\EventListener\OrderEventSubscriber">
            <argument type="service" id="ekyna_commerce.order.number_generator" />
            <argument type="service" id="ekyna_commerce.order.calculator" />
            <argument type="service" id="ekyna_commerce.order.state_resolver" />
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Form types -->
        <service id="ekyna_commerce.country_choice.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\CountryChoiceType">
            <argument>%ekyna_commerce.country.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.currency_choice.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\CurrencyChoiceType">
            <argument>%ekyna_commerce.currency.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.customer_address.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\CustomerAddressType">
            <argument>%ekyna_commerce.customer_address.class%</argument>
            <argument>%ekyna_commerce.country.class%</argument>
            <argument>%ekyna_commerce.customer.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.customer.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\CustomerType">
            <argument>%ekyna_commerce.customer.class%</argument>
            <argument>%ekyna_commerce.customer_group.class%</argument>
            <argument>%ekyna_user.user.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.order_address.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderAddressType">
            <argument>%ekyna_commerce.order_address.class%</argument>
            <argument>%ekyna_commerce.country.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.order_adjustment.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderAdjustmentType">
            <argument>%ekyna_commerce.order_adjustment.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.order_item_adjustment.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderItemAdjustmentType">
            <argument>%ekyna_commerce.order_item_adjustment.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.order_item.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderItemType">
            <argument>%ekyna_commerce.order_item.class%</argument>
            <argument type="service" id="ekyna_commerce.subject.helper"/>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.order.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\OrderType">
            <argument>%ekyna_commerce.order.class%</argument>
            <argument>%ekyna_commerce.customer.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.tax_group.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\TaxGroupType">
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <argument>%ekyna_commerce.tax_rule.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.tax_rule.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\TaxRuleType">
            <argument>%ekyna_commerce.tax_rule.class%</argument>
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <argument>%ekyna_commerce.tax.class%</argument>
            <argument>%ekyna_commerce.customer_group.class%</argument>
            <tag name="form.type" />
        </service>
        <service id="ekyna_commerce.tax.form_type" class="Ekyna\Bundle\CommerceBundle\Form\Type\TaxType">
            <argument>%ekyna_commerce.tax.class%</argument>
            <argument>%ekyna_commerce.country.class%</argument>
            <tag name="form.type" />
        </service>

        <!-- Table types -->
        <service id="ekyna_commerce.customer.table_type" class="Ekyna\Bundle\CommerceBundle\Table\Type\CustomerType">
            <argument>%ekyna_commerce.customer.class%</argument>
            <argument>%ekyna_commerce.customer_group.class%</argument>
            <tag name="table.type" alias="ekyna_commerce_customer" />
        </service>

        <!-- Table column types -->
        <service id="ekyna_commerce.order_customer.column_type" class="Ekyna\Bundle\CommerceBundle\Table\Column\OrderCustomerType">
            <argument type="service" id="ekyna_user.helper.identity"/>
            <tag name="table.column_type" alias="ekyna_commerce_order_customer" />
        </service>
        <service id="ekyna_commerce.order_state.column_type" class="Ekyna\Bundle\CommerceBundle\Table\Column\OrderStateType">
            <argument type="service" id="ekyna_commerce.state_helper"/>
            <tag name="table.column_type" alias="ekyna_commerce_order_state" />
        </service>
        <service id="ekyna_commerce.payment_state.column_type" class="Ekyna\Bundle\CommerceBundle\Table\Column\PaymentStateType">
            <argument type="service" id="ekyna_commerce.state_helper"/>
            <tag name="table.column_type" alias="ekyna_commerce_payment_state" />
        </service>
        <service id="ekyna_commerce.shipment_state.column_type" class="Ekyna\Bundle\CommerceBundle\Table\Column\ShipmentStateType">
            <argument type="service" id="ekyna_commerce.state_helper"/>
            <tag name="table.column_type" alias="ekyna_commerce_shipment_state" />
        </service>

        <!-- Twig extensions -->
        <service id="ekyna_commerce.twig.address_extension" class="Ekyna\Bundle\CommerceBundle\Twig\AddressExtension">
            <tag name="twig.extension" />
        </service>
        <service id="ekyna_commerce.twig.order_extension" class="Ekyna\Bundle\CommerceBundle\Twig\OrderExtension">
            <argument type="service" id="ekyna_commerce.state_helper"/>
            <tag name="twig.extension" />
        </service>
        <service id="ekyna_commerce.twig.payment_extension" class="Ekyna\Bundle\CommerceBundle\Twig\PaymentExtension">
            <argument type="service" id="ekyna_commerce.state_helper"/>
            <tag name="twig.extension" />
        </service>
        <service id="ekyna_commerce.twig.shipment_extension" class="Ekyna\Bundle\CommerceBundle\Twig\ShipmentExtension">
            <argument type="service" id="ekyna_commerce.state_helper"/>
            <tag name="twig.extension" />
        </service>

    </services>

</container>
